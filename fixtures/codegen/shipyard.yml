openapi: 3.0.0
info:
  version: 0.0.0
  title: APIs for building docker images.
paths:
  "/{repository}/applications":
    get:
      description: Get all applications for this repository
      operationId: getAllApplications
      responses:
        "200":
          description: The request was for a repository and applications exist within that
            repository
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Application"
        "404":
          description: The request was for a repository that does not exist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    post:
      description: Create an image of the specified revision
      operationId: createApplication
      responses:
        "201":
          description: The request was for a valid repo, application, and image.  The
            image was created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Image"
        "404":
          description: The repository and application does not exist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: Application and image already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                application:
                  description: The Application name
                  type: string
                revision:
                  description: The Revision of the image
                  type: string
                file:
                  description: The file data as a multipart
                  type: string
                  format: binary
              required:
                - application
                - revision
                - file
        required: true
    parameters:
      - $ref: "#/components/parameters/repository"
  "/{repository}/apps/{application}/images":
    get:
      description: Get all built images for the application in the repository
      operationId: getImageRevisions
      responses:
        "200":
          description: The request was for a valid repository and application
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Image"
        "404":
          description: The request was for a repository or application that does not exist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    parameters:
      - $ref: "#/components/parameters/repository"
      - $ref: "#/components/parameters/application"
  "/{repository}/apps/{application}/images/{revision}":
    get:
      description: Get the image for the specfied revision of the application within
        the repo
      operationId: getImage
      responses:
        "200":
          description: The request was for a valid repository and application and revision
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Image"
        "404":
          description: The request was for a repository or application that does not exist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    parameters:
      - $ref: "#/components/parameters/repository"
      - $ref: "#/components/parameters/application"
      - $ref: "#/components/parameters/revision"
tags:
  - name: deploy
    description: Deploy operation
servers:
  - url: /beeswax/images/api/v1
components:
  parameters:
    repository:
      name: repository
      in: path
      description: The Docker repository name
      required: true
      schema:
        type: string
    application:
      name: application
      in: path
      description: The Application name
      required: true
      schema:
        type: string
    revision:
      name: revision
      in: path
      description: The revision of the application
      required: true
      schema:
        type: string
  schemas:
    Image:
      description: An image of an application and revision
      allOf:
        - $ref: "#/components/schemas/Links"
        - type: object
          properties:
            created:
              description: The timestamp the image was created
              type: string
              format: date-time
            size:
              description: The size of the image, in bytes
              type: integer
            imageId:
              description: The docker image id SHA
              type: string
          required:
            - created
            - size
            - imageId
    Application:
      description: An application
      allOf:
        - $ref: "#/components/schemas/Links"
        - type: object
          properties:
            name:
              description: The name of the application
              type: string
          required:
            - name
    Error:
      description: Object used for all API errors.
      type: object
      properties:
        message:
          type: string
        logs:
          type: array
          items:
            type: string
      required:
        - message
    Links:
      description: Object used to wrap resource links.
      type: object
      properties:
        _links:
          description: Container for any number of named resource links.
          type: object
          additionalProperties:
            description: A resource link.
            type: object
            properties:
              href:
                description: The link to the resource.
                format: uri
                type: string
            required:
              - href
      required:
        - _links
