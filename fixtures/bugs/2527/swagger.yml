openapi: 3.0.0
info:
  title: Exchange Automator 2
  version: "1.0"
  description: Exchange trading automator. Internal only service.
security:
  - ApiKeyAuth: []
tags:
  - name: Currency exchange rate
    description: Get exchange currency rate info
  - name: Deposit
  - name: Trading
paths:
  /swagger.yml:
    get:
      description: Returns swagger api specs
      tags:
        - Swagger
      responses:
        "200":
          description: Swagger specs contents
  /exchange_rate:
    get:
      description: Returns currency exchange rate. If both sourceAmount and
        targetAmount is provided, targetAmount will be ignored.
      tags:
        - Currency exchange rate
      parameters:
        - name: exchange
          description: Exchange to query
          in: query
          required: true
          schema:
            type: string
        - name: source
          description: Source currency to be converted from
          in: query
          required: true
          schema:
            type: string
        - name: target
          description: Target currency to be converted to
          in: query
          required: true
          schema:
            type: string
        - name: sourceAmount
          description: If set, returns target currency amount, selling this amount of
            source currency, default 1
          in: query
          schema:
            type: number
            format: double
        - name: targetAmount
          description: If set, returns source currency amount, buying this amount of
            target currency
          in: query
          schema:
            type: number
            format: double
      responses:
        "200":
          description: Currency rate object
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CurrencyRate"
        "401":
          $ref: "#/components/responses/401"
        "422":
          $ref: "#/components/responses/422"
        "503":
          $ref: "#/components/responses/503"
  /deposits:
    get:
      description: Returns deposits list across all exchanges
      tags:
        - Deposit
      parameters:
        - name: accountId
          description: Filter by account ID
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          description: Filter by deposit transaction status
          in: query
          schema:
            type: string
            enum:
              - pending
              - mempool
              - something
              - else
      responses:
        "200":
          description: Deposit list
          content:
            application/json:
              schema:
                type: object
                properties:
                  deposits:
                    type: array
                    items:
                      $ref: "#/components/schemas/Deposit"
        "401":
          $ref: "#/components/responses/401"
  "/exchange_order/{exchangeOrderId}":
    get:
      description: Returns exchange order
      tags:
        - Trading
      parameters:
        - name: exchangeOrderId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Exchange order
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExchangeOrder"
        "401":
          $ref: "#/components/responses/401"
  /exchange_order:
    post:
      description: Creates a currency exchange order, depending on order type, might
        be async
      tags:
        - Trading
      parameters:
        - name: X-Idempotency-Token
          description: Client generated idempotency token for operation deduplication
          in: header
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - exchange
                - incomingTxId
                - source
                - target
                - sourceAmount
              properties:
                type:
                  type: string
                  description: defaults to 'market'
                  enum:
                    - market
                    - limit
                exchange:
                  $ref: "#/components/schemas/Exchange"
                incomingTxId:
                  type: string
                  description: Incoming deposit transaction id
                source:
                  type: string
                target:
                  type: string
                sourceAmount:
                  type: number
                  format: double
        required: true
      responses:
        "200":
          description: Exchange order
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExchangeOrder"
        "401":
          $ref: "#/components/responses/401"
servers:
  - url: https://localhost/api/v1
components:
  responses:
    "401":
      description: Not authorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    "422":
      description: Unprocessable entity
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    "503":
      description: Service temporarily unavailable
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
  securitySchemes:
    ApiKeyAuth:
      name: X-API-Key
      description: API keys are all predefined for all internal services
      type: apiKey
      in: header
  schemas:
    Exchange:
      description: Exchange Id
    CurrencyRate:
      type: object
      properties:
        exchange:
          type: string
        timestamp:
          description: Most likely near to current moment
          type: integer
          format: int64
        source:
          type: string
          description: Source currency ticker
        target:
          type: string
          description: Target currency ticker
        rate:
          type: number
          format: double
        sourceAmount:
          type: number
          format: double
        targetAmount:
          type: number
          format: double
    Deposit:
      type: object
      description: Field list is not final, will be added during development
      properties:
        exchange:
          $ref: "#/components/schemas/Exchange"
        accountId:
          type: string
          format: uuid
        txId:
          description: Transaction Id
          type: string
        clientId:
          description: Client Id, identified via external system, after receiving
        ticker:
          type: string
        amount:
          type: number
          format: double
    ExchangeOrder:
      type: object
      required:
        - exchange
        - incomingTxId
        - source
        - target
        - sourceAmount
      properties:
        id:
          type: string
          description: Created order Id
        type:
          type: string
          description: defaults to 'market'
          enum:
            - market
            - limit
        exchange:
          $ref: "#/components/schemas/Exchange"
        incomingTxId:
          type: string
          description: Incoming deposit transaction id
        source:
          type: string
        target:
          type: string
        sourceAmount:
          type: number
          format: double
        targetAmount:
          description: Target currency amount after or during exchange processing. Total
            of transactions amounts
          type: number
          format: double
        status:
          type: string
          enum:
            - pending
            - processing
            - executed
        transactions:
          type: array
          items:
            type: string
    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error description
