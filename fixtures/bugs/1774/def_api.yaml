openapi: 3.0.0
info:
  description: REST API for the User Management Service
  version: "1"
  title: User Management
  contact:
    email: development@bbgo.org
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
tags:
  - name: User
    description: User
  - name: Token
    description: Token
paths:
  /users:
    post:
      tags:
        - User
      summary: an operation to register a new user
      description: Registers a new user
      operationId: registerUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: ./Data.yaml
        description: Data for the user to be registered
        required: true
      responses:
        "201":
          description: Created
          headers:
            Location:
              description: URI of the registered resource
              schema:
                type: string
            ETag:
              description: Fingerprint of the created resource
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: ./User.yaml
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "500":
          $ref: ./responses.yaml#/500
    get:
      tags:
        - User
      summary: Get all users
      description: Get all users
      operationId: getUsers
      parameters:
        - $ref: ./parameters.yaml#/filter
        - $ref: ./parameters.yaml#/top
        - $ref: ./parameters.yaml#/skip
        - $ref: ./parameters.yaml#/search
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: ./Users.yaml
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "404":
          $ref: ./responses.yaml#/404
        "500":
          $ref: ./responses.yaml#/500
      security:
        - tokenAuth:
            - ADMIN
            - USER
  "/users/{id}":
    get:
      tags:
        - User
      summary: Retrieve a user by ID
      description: Returns user
      operationId: getUser
      parameters:
        - in: path
          name: id
          description: User ID
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          headers:
            ETag:
              description: Fingerprint of the user object retrieved
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: ./User.yaml
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "404":
          $ref: ./responses.yaml#/404
        "500":
          $ref: ./responses.yaml#/500
      security:
        - tokenAuth:
            - ADMIN
            - USER
    delete:
      tags:
        - User
      summary: Deletes a user
      description: Deletes a user
      operationId: deleteUser
      parameters:
        - name: id
          in: path
          description: ID of a user to delete
          required: true
          schema:
            type: string
      responses:
        "204":
          $ref: ./responses.yaml#/204
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "404":
          $ref: ./responses.yaml#/404
        "500":
          $ref: ./responses.yaml#/500
      security:
        - tokenAuth:
            - ADMIN
            - USER
  "/users/{id}/data":
    put:
      tags:
        - User
      summary: Update an existing user data
      description: Updates data for an existing user
      operationId: updateData
      parameters:
        - in: path
          name: id
          description: ID of the user to update
          required: true
          schema:
            type: string
        - $ref: ./parameters.yaml#/ifmatch
      requestBody:
        content:
          application/json:
            schema:
              $ref: ./Data.yaml
        description: User data to be updated
        required: true
      responses:
        "200":
          description: OK
          headers:
            ETag:
              description: Fingerprint of the user object updated
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: ./User.yaml
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "404":
          $ref: ./responses.yaml#/404
        "412":
          $ref: ./responses.yaml#/412
        "500":
          $ref: ./responses.yaml#/500
      security:
        - tokenAuth:
            - ADMIN
            - USER
  "/users/{id}/roles":
    put:
      tags:
        - User
      summary: Update roles for an existing user
      description: Updates roles for an existing user
      operationId: updateRoles
      parameters:
        - in: path
          name: id
          description: ID of the user to update
          required: true
          schema:
            type: string
        - $ref: ./parameters.yaml#/ifmatch
      requestBody:
        content:
          application/json:
            schema:
              $ref: ./Roles.yaml
        description: User roles to be updated
        required: true
      responses:
        "200":
          description: OK
          headers:
            ETag:
              description: Fingerprint of the user object updated
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: ./User.yaml
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "404":
          $ref: ./responses.yaml#/404
        "412":
          $ref: ./responses.yaml#/412
        "500":
          $ref: ./responses.yaml#/500
      security:
        - tokenAuth:
            - ADMIN
            - USER
  /token:
    post:
      tags:
        - Token
      summary: Issues a token for an authenticated user
      description: Issues a token for an authenticated user
      operationId: issueToken
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: ./AccessToken.yaml
        "400":
          $ref: ./responses.yaml#/400
        "401":
          $ref: ./responses.yaml#/401
        "403":
          $ref: ./responses.yaml#/403
        "404":
          $ref: ./responses.yaml#/404
        "412":
          $ref: ./responses.yaml#/412
        "500":
          $ref: ./responses.yaml#/500
      security:
        - basicAuth: []
servers:
  - url: /user-service/v1
components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    tokenAuth:
      type: apiKey
      in: header
      name: Authorization
